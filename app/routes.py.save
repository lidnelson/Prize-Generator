from app import app, db
import random
from random import randint
import string
from boto3 import client
from flask import render_template, Flask, url_for, redirect
from app.forms import Name
from app.models import Prizes
import json

def random_with_N_digits(n):
	range_start = 10**(n-1)
	range_end = (10**n)-1
	return randint(range_start, range_end)


def randomString(stringLength=5):
	letters = string.ascii_uppercase
	return ''.join(random.choice(letters) for i in range(stringLength))


@app.route("/",  methods=['GET','POST'])
@app.route('/home', methods=['GET','POST'])
def home():
	form = Name()
	def prize():
		letters = awsFunction.invoke(
					FunctionName='randomletter',
					InvocationType='RequestResponse')
		firstletters = json.loads(letters['Payload'].read().decode("utf-8"))

		numbers = awsFunction.invoke(
					FunctionName='randomnumber',
					InvocationType='RequestResponse')
		firstnumb = json.loads(letters['Payload'].read().decode("utf-8"))
	prize_name = (random.choice(prizes))
	
	randomnumbers = str(random_with_N_digits(3))
	randomletters = str(randomString(5))
	unique_id = randomnumbers + randomletters
	if form.validate_on_submit():
		User = Prizes(firstname=form.firstname.data.capitalize(), lastname=form.lastname.data.capitalize(), uniqueid=unique_id, prize=prize_name)
		db.session.add(User)
		db.session.commit()
		temp = Prizes.query.filter_by(uniqueid=unique_id).first()
		return redirect(url_for('spin', id=temp.id))
	return render_template('home.html', title='Home', form=form)


@app.route('/spin/<int(min=1):id>')
def spin(id):
	temp = Prizes.query.filter_by(id=id).first()
	return render_template('spin.html', title="Spin", spin=temp)
